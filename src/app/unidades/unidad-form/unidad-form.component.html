<div class="container">
  <div class="card">
    <h1>{{ esEdicion ? 'Editar Unidad' : 'Nueva Unidad' }}</h1>

    <div *ngIf="mensaje" class="alert" [ngClass]="{'alert-success': tipoMensaje === 'success', 'alert-danger': tipoMensaje === 'danger'}">
      {{ mensaje }}
    </div>

    <div *ngIf="usuarios.length === 0" class="alert alert-danger">
      No hay usuarios disponibles. Por favor, <a routerLink="/usuarios/nuevo">cree un usuario</a> primero.
    </div>

     <form [formGroup]="unidadForm" (ngSubmit)="guardar()" *ngIf="usuarios.length > 0">
       <div class="form-group">
         <label for="license_plate">Placa{{ !esEdicion ? ' *' : '' }}</label>
         <input
           type="text"
           id="license_plate"
           class="form-control"
           formControlName="license_plate"
           placeholder="ABC-123"
           [readonly]="esEdicion"
           [class.is-invalid]="license_plate?.invalid && license_plate?.touched"
         />
         <div *ngIf="license_plate?.invalid && license_plate?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="license_plate?.errors?.['required'] && !esEdicion">La placa es requerida</div>
           <div *ngIf="license_plate?.errors?.['pattern']">La placa debe tener el formato ABC-123</div>
         </div>
       </div>

       <div class="form-group">
         <label for="brand">Marca{{ !esEdicion ? ' *' : '' }}</label>
         <input
           type="text"
           id="brand"
           class="form-control"
           formControlName="brand"
           [class.is-invalid]="brand?.invalid && brand?.touched"
         />
         <div *ngIf="brand?.invalid && brand?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="brand?.errors?.['required'] && !esEdicion">La marca es requerida</div>
           <div *ngIf="brand?.errors?.['minlength']">La marca debe tener al menos 2 caracteres</div>
         </div>
       </div>

       <div class="form-group">
         <label for="model">Modelo{{ !esEdicion ? ' *' : '' }}</label>
         <input
           type="text"
           id="model"
           class="form-control"
           formControlName="model"
           [class.is-invalid]="model?.invalid && model?.touched"
         />
         <div *ngIf="model?.invalid && model?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="model?.errors?.['required'] && !esEdicion">El modelo es requerido</div>
           <div *ngIf="model?.errors?.['minlength']">El modelo debe tener al menos 2 caracteres</div>
         </div>
       </div>

       <div class="form-group">
         <label for="year">Año{{ !esEdicion ? ' *' : '' }}</label>
         <input
           type="number"
           id="year"
           class="form-control"
           formControlName="year"
           [min]="1900"
           [max]="anioMaximo"
           [class.is-invalid]="year?.invalid && year?.touched"
         />
         <div *ngIf="year?.invalid && year?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="year?.errors?.['required'] && !esEdicion">El año es requerido</div>
           <div *ngIf="year?.errors?.['min'] || year?.errors?.['max']">El año debe estar entre 1900 y {{ anioMaximo }}</div>
         </div>
       </div>

       <div class="form-group">
         <label for="capacity">Capacidad{{ !esEdicion ? ' *' : '' }}</label>
         <input
           type="number"
           id="capacity"
           class="form-control"
           formControlName="capacity"
           placeholder="Capacidad en kg"
           [class.is-invalid]="capacity?.invalid && capacity?.touched"
         />
         <div *ngIf="capacity?.invalid && capacity?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="capacity?.errors?.['required'] && !esEdicion">La capacidad es requerida</div>
           <div *ngIf="capacity?.errors?.['min']">La capacidad debe ser mayor a 0</div>
         </div>
       </div>

       <div class="form-group">
         <label for="user_id">Usuario Asignado{{ !esEdicion ? ' *' : '' }}</label>
         <select
           id="user_id"
           class="form-control"
           formControlName="user_id"
           [class.is-invalid]="user_id?.invalid && user_id?.touched"
         >
           <option value="">Seleccione un usuario</option>
           <option *ngFor="let usuario of usuarios" [value]="usuario.id">
             {{ usuario.nombre }} ({{ usuario.email }})
           </option>
         </select>
         <div *ngIf="user_id?.invalid && user_id?.touched" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           <div *ngIf="user_id?.errors?.['required'] && !esEdicion">Debe seleccionar un usuario</div>
         </div>
         <div *ngIf="usuarios.length === 0" style="color: #dc3545; font-size: 12px; margin-top: 5px;">
           No hay usuarios disponibles. <a routerLink="/usuarios/nuevo">Crear usuario</a>
         </div>
       </div>

      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button type="submit" class="btn btn-success" [disabled]="unidadForm.invalid">
          {{ esEdicion ? 'Actualizar' : 'Crear' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
